/*! jquery-clock-interval-picker 2016-03-01 */
$(function(){var a=24,b="AM",c="PM",d="AM/PM";$.widget("jh.clockTimeIntervalPicker",{options:{width:500,height:500,multiSelection:!0,showFaceCircle:!1,enableAmPmButtons:!0,showToggleLayoutButton:!1,showHourLabels:!1,faceTicksLargeLength:10,faceTicksLargeOptions:{strokeWidth:5},faceTicksTinyLength:5,faceTicksTinyOptions:{strokeWidth:2},faceCircleOptions:{fill:"black",fillOpacity:0,stroke:"black",strokeOpacity:0,strokeWidth:2},faceOverlayOptions:{fill:"blue",fillOpacity:.4,stroke:"blue",strokeOpacity:.4,strokeWidth:1}},_create:function(){this.circleRadius=Math.min(this.options.height,this.options.width)/2-2*parseInt(this._getCssClassValue("hour-label","font-size")),console.log("Radius of Circle are:"+this.circleRadius);var b=this,c=0,d=0,e=!1,f=this.circleRadius+a;this.options.showFaceCircle&&(f+=this.options.faceCircleOptions.strokeWidth),this.actualStartTime=null,this.selectedIntervals=[],this.intervalCount=0,this.ctrlHold=!1,this.amEnabled=!0,this.pmEnabled=!0,this.actualArcStartPoint={},this.arcPath=null,this.interactionGroups=[],this.svg=null,this.element.css("width",this.options.width),this.element.css("height",this.options.height),this.element.css("position","relative"),this.interactionGroupOptions=this.options.faceOverlayOptions,this.interactionGroupOptions.transform="translate("+f+","+f+")",this._createElements(f),this.element.svgContainer.mousedown(function(a){return b._clearTextSelection(),3===a.which?void(b.intervalCount>0?(b._clearSelection(),b.element.trigger("selectionChanged",{intervals:{}})):(b.amEnabled&&b.selectedIntervals.push({startTime:{hours:0,minutes:0},endTime:{hours:11,minutes:59}}),b.pmEnabled&&b.selectedIntervals.push({startTime:{hours:12,minutes:0},endTime:{hours:23,minutes:59}}),b.interactionGroups.push(b.svg.group(b.interactionGroupOptions)),b.svg.circle(b.interactionGroups[b.intervalCount],0,0,b.circleRadius),b.intervalCount++,b.element.trigger("selectionChanged",{intervals:b.selectedIntervals}))):(b.ctrlHold=a.ctrlKey&&b.options.multiSelection,b.ctrlHold||b._clearSelection(),b.actualArcStartPoint=b._getArcPointFromAbsolutePosition(a.pageX,a.pageY),b._drawSvgArc(null),b.actualStartTime=b._getTimeFromAbsolutePosition(a.pageX,a.pageY),e=!0,void b.element.trigger("selectionStarted",{intervals:b._getIntervalsFromTimeObj(b.actualStartTime,null,b.amEnabled,b.pmEnabled)}))}),this.element.svgContainer.mouseup(function(a){if(3!==a.which){b._clearTextSelection();var c=b._getTimeFromAbsolutePosition(a.pageX,a.pageY);b.intervalCount++,e=!1;var d=b._getIntervalsFromTimeObj(b.actualStartTime,c,b.amEnabled,b.pmEnabled);b.selectedIntervals=b.selectedIntervals.concat(d),b.actualStartTime=null,b.element.trigger("selectionEnded",{intervals:d}),b.element.trigger("selectionChanged",{intervals:b.selectedIntervals})}}),this.element.svgContainer.mouseleave(function(){b.element.tooltipContainer.hide()}),this.element.svgContainer.mouseenter(function(){b.element.tooltipContainer.show()}),this.element.svgContainer.mousemove(function(a){if(a.pageX!==d||a.pageY!==c){d=a.pageX,c=a.pageY,b._clearTextSelection();var f=b._getRelativePosition(d,c),g=b._getAngleFromRelativePosition(f.x,f.y),h=b._getTimeFromAngle(g),i=b.element.offset();if(b.element.tooltipContainer.css("left",d-i.left+15).css("top",c-i.top).text(b._getTooltipText(h)),e){var j=g+180,k=b._polarToCartesian(0,0,b.circleRadius,j);b._drawSvgArc(k,j)}}})},_getCssClassValue:function(a,b){var c=$("<p></p>").addClass(a).hide().appendTo(this.element),d=c.css(b);return c.remove(),d},_getRelativePosition:function(a,b){var c=this.element.svgContainer.offset();return{x:a-c.left,y:b-c.top}},_clearTextSelection:function(){window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()},_getTimeFromAbsolutePosition:function(a,b){var c=this._getRelativePosition(a,b),d=this._getAngleFromRelativePosition(c.x,c.y);return this._getTimeFromAngle(d)},_getArcPointFromAbsolutePosition:function(a,b){var c=this._getRelativePosition(a,b),d=this._getAngleFromRelativePosition(c.x,c.y),e=-1*(d+180)*(Math.PI/180);return{x:this.circleRadius*Math.cos(e),y:this.circleRadius*Math.sin(e)*-1,angle:d}},_getAngleFromRelativePosition:function(a,b){var c=this.svgWidthHeight/2;return 180*Math.atan2(c-b,c-a)/Math.PI},_getTooltipText:function(a){var e="",f="";if(this.amEnabled&&this.pmEnabled?f=d:this.amEnabled?f=b:this.pmEnabled&&(f=c),null!==this.actualStartTime){e+=this._timeObjectToString(this.actualStartTime),this.amEnabled&&this.pmEnabled||(e+=" "+f),e+=" - ";var g=this.actualStartTime.hours-a.hours;this.actualStartTime.hours<12&&(a.hours>=12||g>0||0===g&&this.actualStartTime.minutes>a.minutes)&&(f===b?f=c:f===c&&(f=b))}return e+=this._timeObjectToString(a)+" "+f},_polarToCartesian:function(a,b,c,d){var e=d*Math.PI/180,f=a+c*Math.cos(e),g=b+c*Math.sin(e);return{x:f,y:g}},_getTimeFromAngle:function(a){var b=a+180,c=3-1/30*(b%360)*-1;0>c&&(c+=12),c>12&&(c-=12);var d=parseInt(c);0===d&&(d=12);var e=parseInt(60*c)%60;return{hours:d,minutes:e}},_getIntervalsFromTimeObj:function(a,b,c,d){var e=[],f=$.extend({},a),g=$.extend({},b);if(c&&d){var h=$.extend({},a),i=$.extend({},b);12===a.hours&&(f.hours-=12),null!==b?(b.hours<a.hours&&a.hours<12&&(g.hours+=12),e.push({startTime:f,endTime:g})):e.push({startTime:f}),a.hours<12&&(h.hours+=12),null!==b?(b.hours<12&&b.hours>a.hours&&(i.hours+=12),b.hours<=a.hours&&12===b.hours&&(i.hours-=12),e.push({startTime:h,endTime:i})):e.push({startTime:h})}else d?(a.hours<12&&(f.hours+=12),null!==b?(b.hours<12&&b.hours>a.hours&&(g.hours+=12),b.hours<=f.hours&&12===b.hours&&(g.hours-=12),e.push({startTime:f,endTime:g})):e.push({startTime:f})):c?(12===a.hours&&(f.hours-=12),null!==b?(b.hours<a.hours&&a.hours<12&&(g.hours+=12),e.push({startTime:f,endTime:g})):e.push({startTime:f})):console.error("Illegal State: AM/PM");return e},_drawSvgArc:function(a,b){if(this.ctrlHold){if(this.interactionGroups.length>=this.intervalCount)for(var c=this.intervalCount;c<this.interactionGroups.length;c++)this.svg.remove(this.interactionGroups[c]),this.interactionGroups.pop()}else this._clearArcGroups();if(this.interactionGroups.length!==this.intervalCount&&(console.error("length: "+this.interactionGroups.length),console.error("Count:  "+this.intervalCount)),this.interactionGroups.push(this.svg.group(this.interactionGroupOptions)),this.arcPath=this.svg.createPath(),null===a)this.arcPath.move(0,0).line([[0,0],[this.actualArcStartPoint.x,this.actualArcStartPoint.y]]).close();else{var d,e=this.actualArcStartPoint.angle+180-b;this.actualArcStartPoint.angle>=90&&this.actualArcStartPoint.angle<=180?d=0>e&&e>-90||360>=e&&e>180?0:1:this.actualArcStartPoint.angle<=-90&&this.actualArcStartPoint.angle>=-180||this.actualArcStartPoint.angle>=-90&&this.actualArcStartPoint.angle<=0?d=e>-180&&0>e?0:1:this.actualArcStartPoint.angle>=0&&this.actualArcStartPoint.angle<=90&&(d=0>e&&e>-180||e>180?0:1),this.arcPath.move(0,0).line([[0,0],[this.actualArcStartPoint.x,this.actualArcStartPoint.y]]).arc(this.circleRadius,this.circleRadius,1,d,1,a.x,a.y).line([[a.x,a.y],[0,0]]).close()}this.svg.path(this.interactionGroups[this.intervalCount],this.arcPath)},_clearArcGroups:function(){if(this.interactionGroups.length>0)for(var a=0;a<this.interactionGroups.length;a++)this.svg.remove(this.interactionGroups[a]);this.interactionGroups=[]},_clearSelection:function(){this.actualStartTime=null,this.actualArcStartPoint={},this.intervalCount=0,this.selectedIntervals=[],this._clearArcGroups(),this.arcPath=null},_timeObjectToString:function(a){return(a.hours<10?"0"+a.hours:a.hours)+":"+(a.minutes<10?"0"+a.minutes:a.minutes)},_createElements:function(e){function f(b){g.svg=b,$(b.root()).attr("width","100%").attr("height","100%");var c=g.circleRadius,d=g.svgWidthHeight/2;g.options.showFaceCircle&&b.circle(d,d,c,g.options.faceCircleOptions);for(var f=b.group({stroke:"black",transform:"translate("+e+","+e+")"}),h=g.circleRadius-g.options.faceTicksTinyLength,i=g.options.faceTicksTinyOptions,j=0;360>j;j+=6)i.transform="rotate("+j+")",b.line(f,0,g.circleRadius,0,h,i);var k=g.circleRadius-g.options.faceTicksLargeLength;for(j=0;360>j;j+=30)i=g.options.faceTicksLargeOptions,i.transform="rotate("+j+")",b.line(f,0,g.circleRadius,0,k,i);g.options.showHourLabels&&(b.text(f,0,g.circleRadius+a,"6"),b.text(f,-g.circleRadius-a,0,"9"),b.text(f,0,-g.circleRadius-a,"12"),b.text(f,g.circleRadius+a,0,"3"),$("text",b.root()).attr("text-anchor","middle").addClass("hour-label"))}var g=this;this.element.tooltipContainer=$("<div></div>").addClass("jh-tooltip-container").hide().appendTo(this.element);var h;if(this.options.showToggleLayoutButton||this.options.enableAmPmButtons){var i=$("<div></div>").addClass("jh-button-container").appendTo(this.element);if(this.options.showToggleLayoutButton){var j=$("<div></div>").addClass("jh-toggle-button-container").css("float","left").appendTo(i).css("float","right");$(' <input type="checkbox" id="clockLayout"><label for="clockLayout">24h</label> ').appendTo(j),$("#clockLayout").button().on("change",function(){var a=$(this).is(":checked");g.showTwentyFourClockLayout=a,"undefined"!=typeof h&&(a?h.hide():h.show())})}this.options.enableAmPmButtons&&(h=$("<div></div>").addClass("jh-am-pm-button-container").css("float","left").appendTo(i),$(' <input type="radio" id="jh-am-button" name="radio" value="'+b+'"><label for="jh-am-button">'+b+"</label>").appendTo(h),$(' <input type="radio" id="jh-pm-button" name="radio" value="'+c+'"><label for="jh-pm-button">'+c+"</label>").appendTo(h),$(' <input type="radio" id="jh-both-button" name="radio"  value="'+d+'" checked="checked"><label for="jh-both-button">'+d+"</label>").appendTo(h),h.buttonset(),$("input:radio[name=radio]").change(function(){g.amEnabled=!1,g.pmEnabled=!1,this.value===b?g.amEnabled=!0:this.value===c?g.pmEnabled=!0:this.value===d&&(g.amEnabled=!0,g.pmEnabled=!0)}))}this.svgWidthHeight=2*(this.circleRadius+a),this.options.showFaceCircle&&(this.svgWidthHeight+=2*this.options.faceCircleOptions.strokeWidth),this.element.svgContainer=$("<div></div>").addClass("jh-svg-container").width(this.svgWidthHeight).height(this.svgWidthHeight).attr("oncontextmenu","return false;").appendTo(this.element),this.element.svgContainer.svg({onLoad:f})},_destroy:function(){},_setOption:function(){$.Widget.prototype._setOption.apply(this,arguments)}})});