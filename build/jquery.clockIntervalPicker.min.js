$(function(){var a=24,b="AM",c="PM",d="AM/PM";$.widget("jh.clockTimeIntervalPicker",{options:{width:500,height:500,multiSelection:!0,showFaceCircle:!1,enableAmPmButtons:!0,showToggleLayoutButton:!1,showHourLabels:!1,selectionTicksMinutes:1,showIndicatorLine:!0,indicatorLineOptions:{stroke:"black",strokeWidth:2},faceTicksLargeLength:8,faceTicksLargeOptions:{strokeWidth:4},faceTicksTinyLength:5,faceTicksTinyOptions:{strokeWidth:2},faceCircleOptions:{fill:"black",fillOpacity:0,stroke:"black",strokeOpacity:0,strokeWidth:2},faceOverlayOptions:{fill:"blue",fillOpacity:.4,stroke:"blue",strokeOpacity:.4,strokeWidth:1}},_create:function(){this.circleRadius=Math.min(this.options.height,this.options.width)/2-2*parseInt(this._getCssClassValue("hour-label","font-size")),console.log("Radius of Circle is:"+this.circleRadius);var b=this,c=0,d=0,e=!1;this.actualStartTime=null,this.selectedIntervals=[],this.intervalCount=0,this.ctrlHold=!1,this.amEnabled=!0,this.pmEnabled=!0,this.actualArcStartPoint={},this.arcPath=null,this.interactionGroups=[],this.svg=null,this.svgWidthHeight=2*(this.circleRadius+a),this.options.showFaceCircle&&(this.svgWidthHeight+=2*this.options.faceCircleOptions.strokeWidth),this.middle=this.svgWidthHeight/2,this.indicatorLineGroup=null,this.element.css("width",this.options.width),this.element.css("height",this.options.height),this.element.css("position","relative"),this.interactionGroupOptions=this.options.faceOverlayOptions,this.interactionGroupOptions.transform="translate("+this.middle+","+this.middle+")",this._createElements(),this.element.svgContainer.mousedown(function(a){if(b._clearTextSelection(),3===a.which)return void(b.intervalCount>0?(b._clearSelection(),b.element.trigger("selectionChanged",{intervals:{}})):(b.amEnabled&&b.selectedIntervals.push({startTime:{hours:0,minutes:0},endTime:{hours:11,minutes:59}}),b.pmEnabled&&b.selectedIntervals.push({startTime:{hours:12,minutes:0},endTime:{hours:23,minutes:59}}),b.interactionGroups.push(b.svg.group(b.interactionGroupOptions)),b.svg.circle(b.interactionGroups[b.intervalCount],0,0,b.circleRadius),b.intervalCount++,b.element.trigger("selectionChanged",{intervals:b.selectedIntervals})));b.ctrlHold=a.ctrlKey&&b.options.multiSelection,b.ctrlHold||b._clearSelection();var c=b._getAngleFromAbsolutePosition(a.pageX,a.pageY);b.actualArcStartPoint=b._polarToCartesian(b.circleRadius,c),b._drawSvgArc(null),b.actualStartTime=b._getTimeFromAbsolutePosition(a.pageX,a.pageY),e=!0,b.element.trigger("selectionStarted",{intervals:b._getIntervalsFromTimeObj(b.actualStartTime,null,b.amEnabled,b.pmEnabled)})}),this.element.svgContainer.mouseup(function(a){if(3!==a.which){b._clearTextSelection();var c=b._getTimeFromAbsolutePosition(a.pageX,a.pageY);b.intervalCount++,e=!1;var d=b._getIntervalsFromTimeObj(b.actualStartTime,c,b.amEnabled,b.pmEnabled);b.selectedIntervals=b.selectedIntervals.concat(d),b.actualStartTime=null,b.element.trigger("selectionEnded",{intervals:d}),b.element.trigger("selectionChanged",{intervals:b.selectedIntervals})}}),this.element.svgContainer.mouseleave(function(){b._clearIndicatorLine(),b.element.tooltipContainer.hide()}),this.element.svgContainer.mouseenter(function(){b.element.tooltipContainer.show()}),this.element.svgContainer.mousemove(function(a){if(a.pageX!==d||a.pageY!==c){d=a.pageX,c=a.pageY,b._clearTextSelection();var f=b._getAngleFromAbsolutePosition(d,c),g=b._getTimeFromAngle(f),h=b.element.offset();if(b.element.tooltipContainer.css("left",d-h.left+15).css("top",c-h.top).text(b._getTooltipText(g)),e){var i=b._polarToCartesian(b.circleRadius,f);b._drawSvgArc(i)}b._drawIndicatorLine(f)}})},_polarToCartesian:function(a,b){return{x:a*Math.sin(b),y:a*Math.cos(b)*-1,angle:b}},_drawIndicatorLine:function(a){this._clearIndicatorLine(),this.indicatorLineGroup=this.svg.group({transform:"translate("+this.middle+","+this.middle+")"}),this.options.indicatorLineOptions.transform="rotate("+this._radianToDegrees(a)+")",this.svg.line(this.indicatorLineGroup,0,0,0,-this.circleRadius,this.options.indicatorLineOptions)},_clearIndicatorLine:function(){null!==this.indicatorLineGroup&&(this.svg.remove(this.indicatorLineGroup),this.indicatorLineGroup=null)},_getCssClassValue:function(a,b){var c=$("<p></p>").addClass(a).hide().appendTo(this.element),d=c.css(b);return c.remove(),d},_clearTextSelection:function(){window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()},_getTimeFromAbsolutePosition:function(a,b){var c=this._getAngleFromAbsolutePosition(a,b);return this._getTimeFromAngle(c)},_getAngleFromAbsolutePosition:function(a,b){var c=this.element.svgContainer.offset(),d=a-c.left-this.middle,e=b-c.top-this.middle,f=Math.atan2(e,d)+Math.PI/2;return 0>f&&(f+=2*Math.PI),f},_radianToDegrees:function(a){return a*(180/Math.PI)},_degreesToRadian:function(a){return a*(Math.PI/180)},_getTooltipText:function(a){var e="",f="";if(this.amEnabled&&this.pmEnabled?f=d:this.amEnabled?f=b:this.pmEnabled&&(f=c),null!==this.actualStartTime){e+=this._timeObjectToString(this.actualStartTime),this.amEnabled&&this.pmEnabled||(e+=" "+f),e+=" - ";var g=this.actualStartTime.hours-a.hours;this.actualStartTime.hours<12&&(a.hours>=12||g>0||0===g&&this.actualStartTime.minutes>a.minutes)&&(f===b?f=c:f===c&&(f=b))}return e+=this._timeObjectToString(a)+" "+f},_getTimeFromAngle:function(a){var b=6-1/30*((this._radianToDegrees(a)+180)%360)*-1;0>b&&(b+=12),b>12&&(b-=12);var c=parseInt(b);0===c&&(c=12);var d=parseInt(60*b)%60;return{hours:c,minutes:d}},_getIntervalsFromTimeObj:function(a,b,c,d){var e=[],f=$.extend({},a);12===a.hours&&(f.hours=0);var g=$.extend({},b);return null!==b&&12===b.hours&&(g.hours=0),c&&(null!==b?((g.hours<f.hours||g.hours===f.hours&&g.minutes<f.minutes)&&(g.hours+=12),e.push({startTime:f,endTime:g})):e.push({startTime:f})),d&&(f=$.extend({},a),12===a.hours&&(f.hours=0),g=$.extend({},b),null!==b&&12===b.hours&&(g.hours=0),null!==b?((g.hours<f.hours||g.hours===f.hours&&g.minutes<f.minutes)&&(g.hours-=12),g.hours+=12,f.hours+=12,e.push({startTime:f,endTime:g})):e.push({startTime:f})),e},_drawSvgArc:function(a){if(this.ctrlHold){if(this.interactionGroups.length>=this.intervalCount)for(var b=this.intervalCount;b<this.interactionGroups.length;b++)this.svg.remove(this.interactionGroups[b]),this.interactionGroups.pop()}else this._clearArcGroups();if(this.interactionGroups.length!==this.intervalCount&&(console.error("length: "+this.interactionGroups.length),console.error("Count:  "+this.intervalCount)),this.interactionGroups.push(this.svg.group(this.interactionGroupOptions)),this.arcPath=this.svg.createPath(),null===a)this.arcPath.move(0,0).line([[0,0],[this.actualArcStartPoint.x,this.actualArcStartPoint.y]]).close();else{var c=a.angle-this.actualArcStartPoint.angle,d=!1;c>Math.PI&&(d=!0),0>c&&c>-1*Math.PI&&(d=!d),this.arcPath.move(0,0).line([[0,0],[this.actualArcStartPoint.x,this.actualArcStartPoint.y]]).arc(this.circleRadius,this.circleRadius,1,d,1,a.x,a.y).line([[a.x,a.y],[0,0]]).close()}this.svg.path(this.interactionGroups[this.intervalCount],this.arcPath)},_clearArcGroups:function(){if(this.interactionGroups.length>0)for(var a=0;a<this.interactionGroups.length;a++)this.svg.remove(this.interactionGroups[a]);this.interactionGroups=[]},_clearSelection:function(){this.actualStartTime=null,this.actualArcStartPoint={},this.intervalCount=0,this.selectedIntervals=[],this._clearArcGroups(),this.arcPath=null},_timeObjectToString:function(a){return(a.hours<10?"0"+a.hours:a.hours)+":"+(a.minutes<10?"0"+a.minutes:a.minutes)},_createElements:function(){function e(b){f.svg=b,$(b.root()).attr("width","100%").attr("height","100%");var c=f.circleRadius;f.options.showFaceCircle&&b.circle(f.middle,f.middle,c,f.options.faceCircleOptions);for(var d=b.group({stroke:"black",transform:"translate("+f.middle+","+f.middle+")"}),e=f.circleRadius-f.options.faceTicksTinyLength,g=f.options.faceTicksTinyOptions,h=0;360>h;h+=6)g.transform="rotate("+h+")",b.line(d,0,f.circleRadius,0,e,g);var i=f.circleRadius-f.options.faceTicksLargeLength;for(h=0;360>h;h+=30)g=f.options.faceTicksLargeOptions,g.transform="rotate("+h+")",b.line(d,0,f.circleRadius,0,i,g);f.options.showHourLabels&&(b.text(d,0,f.circleRadius+a,"6"),b.text(d,-f.circleRadius-a,0,"9"),b.text(d,0,-f.circleRadius-a,"12"),b.text(d,f.circleRadius+a,0,"3"),$("text",b.root()).attr("text-anchor","middle").addClass("hour-label"))}var f=this;this.element.tooltipContainer=$("<div></div>").addClass("jh-tooltip-container").hide().appendTo(this.element);var g;if(this.options.showToggleLayoutButton||this.options.enableAmPmButtons){var h=$("<div></div>").addClass("jh-button-container").appendTo(this.element);if(this.options.showToggleLayoutButton){var i=$("<div></div>").addClass("jh-toggle-button-container").appendTo(h);$(' <input type="checkbox" id="clockLayout"><label for="clockLayout">24h</label> ').appendTo(i),$("#clockLayout").button().on("change",function(){var a=$(this).is(":checked");f.showTwentyFourClockLayout=a,"undefined"!=typeof g&&(a?g.hide():g.show())})}this.options.enableAmPmButtons&&(g=$("<div></div>").addClass("jh-am-pm-button-container").appendTo(h),$(' <input type="radio" id="jh-am-button" name="radio" value="'+b+'"><label for="jh-am-button">'+b+"</label>").appendTo(g),$(' <input type="radio" id="jh-pm-button" name="radio" value="'+c+'"><label for="jh-pm-button">'+c+"</label>").appendTo(g),$(' <input type="radio" id="jh-both-button" name="radio"  value="'+d+'" checked="checked"><label for="jh-both-button">'+d+"</label>").appendTo(g),g.buttonset(),$("input:radio[name=radio]").change(function(){f.amEnabled=!1,f.pmEnabled=!1,this.value===b?f.amEnabled=!0:this.value===c?f.pmEnabled=!0:this.value===d&&(f.amEnabled=!0,f.pmEnabled=!0)}))}this.element.svgContainer=$("<div></div>").addClass("jh-svg-container").width(this.svgWidthHeight).height(this.svgWidthHeight).attr("oncontextmenu","return false;").appendTo(this.element),this.element.svgContainer.svg({onLoad:e})},_destroy:function(){},_setOption:function(){$.Widget.prototype._setOption.apply(this,arguments)}})});