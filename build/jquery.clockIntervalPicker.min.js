$(function(){var a=100,b=15,c="AM",d="PM",e="AM/PM",f=24,g=60,h=24*g,i=360,j=i/f,k=2*j,l=k/g;$.widget("jh.clockTimeIntervalPicker",{options:{width:500,height:500,multiSelection:!0,showFaceCircle:!1,enableAmPmButtons:!0,showToggleLayoutButton:!1,showHourLabels:!0,selectionTicksMinutes:10,showIndicatorLine:!0,indicatorLineOptions:{stroke:"black",strokeWidth:2},faceTicksLargeLength:8,faceTicksLargeOptions:{strokeWidth:4},faceTicksTinyLength:5,faceTicksTinyOptions:{strokeWidth:2},faceCircleOptions:{fill:"black",fillOpacity:0,stroke:"black",strokeOpacity:0,strokeWidth:2},faceOverlayOptions:{fill:"blue",fillOpacity:.4,stroke:"blue",strokeOpacity:.4,strokeWidth:1}},_create:function(){var c=this,d=0,e=0,f=!1;this.actualStartTime=null,this.selectedIntervals=[],this.intervalCount=0,this.ctrlHold=!1,this.amEnabled=!0,this.pmEnabled=!0,this.labelFontSize=parseInt(this._getCssClassValue("hour-label","font-size")),this.circleRadius=Math.min(this.options.height,this.options.width)/2-2*this.labelFontSize,this.actualArcStartPoint={},this.arcPath=null,this.interactionGroups=[],this.svg=null,this.svgWidthHeight=2*(this.circleRadius+a),this.options.showFaceCircle&&(this.svgWidthHeight+=2*this.options.faceCircleOptions.strokeWidth),this.middle=this.svgWidthHeight/2,this.indicatorLineGroup=null,this.element.css("width",this.options.width),this.element.css("height",this.options.height),this.element.css("position","relative"),this.interactionGroupOptions=this.options.faceOverlayOptions,this.interactionGroupOptions.transform="translate("+this.middle+","+this.middle+")",this.ticksMinutes=[];for(var g=h/this.options.selectionTicksMinutes,i=0;g>i;i++)this.ticksMinutes.push(i*this.options.selectionTicksMinutes);this._createElements(),this.element.svgContainer.mousedown(function(a){if(c._clearTextSelection(),3===a.which)return void(c.intervalCount>0?(c._clearSelection(),c.element.trigger("selectionChanged",{intervals:{}})):(c.amEnabled&&c.selectedIntervals.push({startTime:{hours:0,minutes:0},endTime:{hours:11,minutes:59}}),c.pmEnabled&&c.selectedIntervals.push({startTime:{hours:12,minutes:0},endTime:{hours:23,minutes:59}}),c.interactionGroups.push(c.svg.group(c.interactionGroupOptions)),c.svg.circle(c.interactionGroups[c.intervalCount],0,0,c.circleRadius),c.intervalCount++,c.element.trigger("selectionChanged",{intervals:c.selectedIntervals})));c.ctrlHold=a.ctrlKey&&c.options.multiSelection,c.ctrlHold||c._clearSelection();var b=c._getTimeFromAbsolutePosition(a.pageX,a.pageY);c.actualStartTime=c._getTickTime(b.hours,b.minutes);var d=c._degreesToRadian(c._getAngleFromTime(c.actualStartTime.hours,c.actualStartTime.minutes));c.actualArcStartPoint=c._polarToCartesian(c.circleRadius,d),c._drawSvgArc(null),f=!0,c.element.trigger("selectionStarted",{intervals:c._getIntervalsFromTimeObj(c.actualStartTime,null,c.amEnabled,c.pmEnabled)})}),this.element.svgContainer.mouseup(function(a){if(3!==a.which){c._clearTextSelection();var b=c._getTimeFromAbsolutePosition(a.pageX,a.pageY),d=c._getTickTime(b.hours,b.minutes);c.intervalCount++,f=!1;var e=c._getIntervalsFromTimeObj(c.actualStartTime,d,c.amEnabled,c.pmEnabled);c.selectedIntervals=c.selectedIntervals.concat(e),c.actualStartTime=null,c.element.trigger("selectionEnded",{intervals:e}),c.element.trigger("selectionChanged",{intervals:c.selectedIntervals})}}),this.element.svgContainer.mouseleave(function(){c._clearIndicatorLine(),c.element.tooltipContainer.hide()}),this.element.svgContainer.mouseenter(function(){c.element.tooltipContainer.show()}),this.element.svgContainer.mousemove(function(a){if(a.pageX!==e||a.pageY!==d){e=a.pageX,d=a.pageY,c._clearTextSelection();var g=c._getTimeFromAngle(c._getAngleFromAbsolutePosition(e,d)),h=c._getTickTime(g.hours,g.minutes),i=c._degreesToRadian(c._getAngleFromTime(h.hours,h.minutes)),j=c.element.offset();if(c.element.tooltipContainer.css("left",e-j.left+b).css("top",d-j.top).text(c._getTooltipText(h)),f){var k=c._polarToCartesian(c.circleRadius,i);c._drawSvgArc(k)}c._drawIndicatorLine(i)}})},_getTickTime:function(a,b){for(var c,d=a*g+b,e=0;e<this.ticksMinutes.length-1;e++){var f=this.ticksMinutes[e],h=this.ticksMinutes[e+1];if(d>=f&&h>=d){var i=d-f,j=h-d;c=j>i?f:h;break}}return{hours:parseInt(c/g),minutes:c%g}},_polarToCartesian:function(a,b){return{x:a*Math.sin(b),y:a*Math.cos(b)*-1,angle:b}},_drawIndicatorLine:function(a){this._clearIndicatorLine(),this.indicatorLineGroup=this.svg.group({transform:"translate("+this.middle+","+this.middle+")"}),this.options.indicatorLineOptions.transform="rotate("+this._radianToDegrees(a)+")",this.svg.line(this.indicatorLineGroup,0,0,0,-this.circleRadius,this.options.indicatorLineOptions)},_clearIndicatorLine:function(){null!==this.indicatorLineGroup&&(this.svg.remove(this.indicatorLineGroup),this.indicatorLineGroup=null)},_getCssClassValue:function(a,b){var c=$("<p></p>").addClass(a).hide().appendTo(this.element),d=c.css(b);return c.remove(),d},_clearTextSelection:function(){window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()},_getTimeFromAbsolutePosition:function(a,b){var c=this._getAngleFromAbsolutePosition(a,b);return this._getTimeFromAngle(c)},_getAngleFromAbsolutePosition:function(a,b){var c=this.element.svgContainer.offset(),d=a-c.left-this.middle,e=b-c.top-this.middle,f=Math.atan2(e,d)+Math.PI/2;return 0>f&&(f+=2*Math.PI),f},_radianToDegrees:function(a){return a*(180/Math.PI)},_degreesToRadian:function(a){return a*(Math.PI/180)},_getTooltipText:function(a){var b="",f="";if(this.amEnabled&&this.pmEnabled?f=e:this.amEnabled?f=c:this.pmEnabled&&(f=d),null!==this.actualStartTime){b+=this._timeObjectToString(this.actualStartTime),this.amEnabled&&this.pmEnabled||(b+=" "+f),b+=" - ";var g=this.actualStartTime.hours-a.hours;this.actualStartTime.hours<12&&(a.hours>=12||g>0||0===g&&this.actualStartTime.minutes>a.minutes)&&(f===c?f=d:f===d&&(f=c))}return b+=this._timeObjectToString(a)+" "+f},_getTimeFromAngle:function(a){var b=6-1/30*((this._radianToDegrees(a)+i/2)%i)*-1;0>b&&(b+=12),b>12&&(b-=12);var c=parseInt(b);12===c&&(c=0);var d=parseInt(b*g)%g;return{hours:c,minutes:d}},_getAngleFromTime:function(a,b){var c=a*k;return c+=b*l},_getIntervalsFromTimeObj:function(a,b,c,d){var e=[],f=$.extend({},a);12===a.hours&&(f.hours=0);var g=$.extend({},b);return null!==b&&12===b.hours&&(g.hours=0),c&&(null!==b?((g.hours<f.hours||g.hours===f.hours&&g.minutes<f.minutes)&&(g.hours+=12),e.push({startTime:f,endTime:g})):e.push({startTime:f})),d&&(f=$.extend({},a),12===a.hours&&(f.hours=0),g=$.extend({},b),null!==b&&12===b.hours&&(g.hours=0),null!==b?((g.hours<f.hours||g.hours===f.hours&&g.minutes<f.minutes)&&(g.hours-=12),g.hours+=12,f.hours+=12,e.push({startTime:f,endTime:g})):e.push({startTime:f})),e},_drawSvgArc:function(a){if(this.ctrlHold){if(this.interactionGroups.length>=this.intervalCount)for(var b=this.intervalCount;b<this.interactionGroups.length;b++)this.svg.remove(this.interactionGroups[b]),this.interactionGroups.pop()}else this._clearArcGroups();if(this.interactionGroups.length!==this.intervalCount&&(console.error("length: "+this.interactionGroups.length),console.error("Count:  "+this.intervalCount)),this.interactionGroups.push(this.svg.group(this.interactionGroupOptions)),this.arcPath=this.svg.createPath(),null===a)this.arcPath.move(0,0).line([[0,0],[this.actualArcStartPoint.x,this.actualArcStartPoint.y]]).close();else{var c=a.angle-this.actualArcStartPoint.angle,d=!1;c>Math.PI&&(d=!0),0>c&&c>-1*Math.PI&&(d=!d),this.arcPath.move(0,0).line([[0,0],[this.actualArcStartPoint.x,this.actualArcStartPoint.y]]).arc(this.circleRadius,this.circleRadius,1,d,1,a.x,a.y).line([[a.x,a.y],[0,0]]).close()}this.svg.path(this.interactionGroups[this.intervalCount],this.arcPath)},_clearArcGroups:function(){if(this.interactionGroups.length>0)for(var a=0;a<this.interactionGroups.length;a++)this.svg.remove(this.interactionGroups[a]);this.interactionGroups=[]},_clearSelection:function(){this.actualStartTime=null,this.actualArcStartPoint={},this.intervalCount=0,this.selectedIntervals=[],this._clearArcGroups(),this.arcPath=null},_timeObjectToString:function(a){var b=a.hours;return 0===b&&(b=12),(10>b?"0"+b:b)+":"+(a.minutes<10?"0"+a.minutes:a.minutes)},_createElements:function(){function a(a){b.svg=a,$(a.root()).attr("width","100%").attr("height","100%").attr("cursor","crosshair");var c=b.circleRadius;b.options.showFaceCircle&&a.circle(b.middle,b.middle,c,b.options.faceCircleOptions);for(var d=a.group({stroke:"black",transform:"translate("+b.middle+","+b.middle+")"}),e=b.circleRadius-b.options.faceTicksTinyLength,f=b.options.faceTicksTinyOptions,g=0;i>g;g+=6)f.transform="rotate("+g+")",a.line(d,0,b.circleRadius,0,e,f);var h=b.circleRadius-b.options.faceTicksLargeLength;for(g=0;i>g;g+=30)f=b.options.faceTicksLargeOptions,f.transform="rotate("+g+")",a.line(d,0,b.circleRadius,0,h,f);b.options.showHourLabels&&(a.text(d,0,-b.circleRadius-12,"12"),a.text(d,0,b.circleRadius+b.labelFontSize+12,"6"),a.text(d,-b.circleRadius-b.labelFontSize,b.labelFontSize/4,"9"),a.text(d,b.circleRadius+b.labelFontSize,b.labelFontSize/4,"3"),$("text",a.root()).attr("text-anchor","middle").addClass("hour-label"))}var b=this;this.element.tooltipContainer=$("<div></div>").addClass("jh-tooltip-container").hide().appendTo(this.element);var f;if(this.options.showToggleLayoutButton||this.options.enableAmPmButtons){var g=$("<div></div>").addClass("jh-button-container").appendTo(this.element);if(this.options.showToggleLayoutButton){var h=$("<div></div>").addClass("jh-toggle-button-container").appendTo(g);$(' <input type="checkbox" id="clockLayout"><label for="clockLayout">24h</label> ').appendTo(h),$("#clockLayout").button().on("change",function(){var a=$(this).is(":checked");b.showTwentyFourClockLayout=a,"undefined"!=typeof f&&(a?f.hide():f.show())})}this.options.enableAmPmButtons&&(f=$("<div></div>").addClass("jh-am-pm-button-container").appendTo(g),$(' <input type="radio" id="jh-am-button" name="radio" value="'+c+'"><label for="jh-am-button">'+c+"</label>").appendTo(f),$(' <input type="radio" id="jh-pm-button" name="radio" value="'+d+'"><label for="jh-pm-button">'+d+"</label>").appendTo(f),$(' <input type="radio" id="jh-both-button" name="radio"  value="'+e+'" checked="checked"><label for="jh-both-button">'+e+"</label>").appendTo(f),f.buttonset(),$("input:radio[name=radio]").change(function(){b.amEnabled=!1,b.pmEnabled=!1,this.value===c?b.amEnabled=!0:this.value===d?b.pmEnabled=!0:this.value===e&&(b.amEnabled=!0,b.pmEnabled=!0)}))}this.element.svgContainer=$("<div></div>").addClass("jh-svg-container").width(this.svgWidthHeight).height(this.svgWidthHeight).attr("oncontextmenu","return false;").appendTo(this.element),this.element.svgContainer.svg({onLoad:a})},_destroy:function(){},_setOption:function(){$.Widget.prototype._setOption.apply(this,arguments)}})});