$(function(){var a=15,b="AM",c="PM",d="AM/PM",e=24,f=60,g=24*f,h=360,i=h/e,j=2*i,k=i/f,l=j/f;$.widget("jh.clockTimeIntervalPicker",{options:{multiSelection:!0,showFaceCircle:!1,enableAmPmButtons:!0,showToggleLayoutButton:!0,useTwelveHoursLayout:!0,showHourLabels:!0,selectionTicksMinutes:30,showIndicatorLine:!0,indicatorLineOptions:{stroke:"black",strokeWidth:2},faceTicksLargeLength:8,faceTicksLargeOptions:{strokeWidth:4},faceTicksTinyLength:5,faceTicksTinyOptions:{strokeWidth:2},faceCircleOptions:{fill:"black",fillOpacity:0,stroke:"black",strokeOpacity:0,strokeWidth:2},faceOverlayOptions:{fill:"blue",fillOpacity:.4,stroke:"blue",strokeOpacity:.4,strokeWidth:1}},_create:function(){this.actualStartTime=null,this.selectedIntervals=[],this.intervalCount=0,this.ctrlHold=!1,this.amEnabled=!0,this.pmEnabled=!0,this.startAngles=[],this.endAngles=[],this.twelveHoursLayout=this.options.useTwelveHoursLayout,this.buttonContainerHeight=0,this._createBasicUIElement(),this.interactionGroupOptions=this.options.faceOverlayOptions,this.actualArcStartPoint={},this.arcPath=null,this.interactionGroups=[],this.svg=null,this.indicatorLineGroup=null,this._initSVGSizeVariables(),this.ticksMinutes=[];for(var a=g/this.options.selectionTicksMinutes,b=0;a>=b;b++)this.ticksMinutes.push(b*this.options.selectionTicksMinutes);this.element.svgContainer=$("<div></div>").addClass("jh-svg-container").width(this.svgWidthHeight).height(this.svgWidthHeight).attr("oncontextmenu","return false;").appendTo(this.element),this._createSVGElements(),this._initMouseEventHandlers()},_initSVGSizeVariables:function(){this.availableWidth=this.element.width(),this.availableHeight=this.element.height(),this.availableSVGWidth=this.availableWidth,this.availableSVGHeight=this.availableHeight-this.buttonContainerHeight,this.svgWidthHeight=Math.min(this.availableSVGWidth,this.availableSVGHeight),this.circleRadius=this.svgWidthHeight/2,this.options.showFaceCircle&&(this.circleRadius-=2*this.options.faceCircleOptions.strokeWidth),this.options.showHourLabels&&(this.hourLabelFontSize=parseInt(this._getCssClassValue("hour-label","font-size")),this.circleRadius-=2*this.hourLabelFontSize),this.middle=this.svgWidthHeight/2,this.interactionGroupOptions.transform="translate("+this.middle+","+this.middle+")"},_initMouseEventHandlers:function(){var b=this,c=0,d=0,e=!1;this.element.svgContainer.mousedown(function(a){if(b._clearTextSelection(),3===a.which)return void(b.intervalCount>0?(b._clearSelection(),b.element.trigger("selectionChanged",{intervals:{}})):(b.amEnabled&&b.selectedIntervals.push({startTime:{hours:0,minutes:0},endTime:{hours:11,minutes:59}}),b.pmEnabled&&b.selectedIntervals.push({startTime:{hours:12,minutes:0},endTime:{hours:23,minutes:59}}),b.interactionGroups.push(b.svg.group(b.interactionGroupOptions)),b.svg.circle(b.interactionGroups[b.intervalCount],0,0,b.circleRadius),b.intervalCount++,b.startAngles.push(0),b.endAngles.push(0),b.element.trigger("selectionChanged",{intervals:b.selectedIntervals})));b.ctrlHold=a.ctrlKey&&b.options.multiSelection,b.ctrlHold||b._clearSelection();var c=b._getTimeFromAbsolutePosition(a.pageX,a.pageY);b.actualStartTime=b._getTickTime(c.hours,c.minutes);var d=b._degreesToRadian(b._getAngleFromTime(b.actualStartTime.hours,b.actualStartTime.minutes));b.actualArcStartPoint=b._polarToCartesian(b.circleRadius,d),b._createSvgArc(b.actualArcStartPoint),e=!0,b.element.trigger("selectionStarted",{intervals:b._getIntervalsFromTimeObj(b.actualStartTime,null,b.amEnabled,b.pmEnabled)})}),this.element.svgContainer.mouseup(function(a){if(3!==a.which){b._clearTextSelection();var c=b._getTimeFromAbsolutePosition(a.pageX,a.pageY),d=b._getTickTime(c.hours,c.minutes);b.intervalCount++,e=!1;var f=b._getIntervalsFromTimeObj(b.actualStartTime,d,b.amEnabled,b.pmEnabled);b.selectedIntervals=b.selectedIntervals.concat(f),b.startAngles.push(b._degreesToRadian(b._getAngleFromTime(b.actualStartTime.hours,b.actualStartTime.minutes))),b.endAngles.push(b._degreesToRadian(b._getAngleFromTime(d.hours,d.minutes))),b.actualStartTime=null,b.element.trigger("selectionEnded",{intervals:f}),b.element.trigger("selectionChanged",{intervals:b.selectedIntervals})}}),this.element.svgContainer.mouseleave(function(){b._clearIndicatorLine(),b.element.tooltipContainer.hide()}),this.element.svgContainer.mouseenter(function(){b.element.tooltipContainer.show()}),this.element.svgContainer.mousemove(function(f){if(f.pageX!==d||f.pageY!==c){d=f.pageX,c=f.pageY,b._clearTextSelection();var g=b._getTimeFromAngle(b._getAngleFromAbsolutePosition(d,c)),h=b._getTickTime(g.hours,g.minutes),i=b._degreesToRadian(b._getAngleFromTime(h.hours,h.minutes)),j=b.element.offset();if(b.element.tooltipContainer.css("left",d-j.left+a).css("top",c-j.top).text(b._getTooltipText(h)),e){var k=b._polarToCartesian(b.circleRadius,i);b._createSvgArc(b.actualArcStartPoint,k)}b._drawIndicatorLine(i)}})},_getTickTime:function(a,b){for(var c,d=a*f+b,e=0;e<this.ticksMinutes.length-1;e++){var g=this.ticksMinutes[e],h=this.ticksMinutes[e+1];if(d>=g&&h>=d){var i=d-g,j=h-d;c=j>i?g:h;break}}var k=parseInt(c/f);return 24===k&&(k=0),{hours:k,minutes:c%f}},_polarToCartesian:function(a,b){return{x:a*Math.sin(b),y:a*Math.cos(b)*-1,angle:b}},_drawIndicatorLine:function(a){this._clearIndicatorLine(),this.indicatorLineGroup=this.svg.group({transform:"translate("+this.middle+","+this.middle+")"}),this.options.indicatorLineOptions.transform="rotate("+this._radianToDegrees(a)+")",this.svg.line(this.indicatorLineGroup,0,0,0,-this.circleRadius,this.options.indicatorLineOptions)},_clearIndicatorLine:function(){null!==this.indicatorLineGroup&&(this.svg.remove(this.indicatorLineGroup),this.indicatorLineGroup=null)},_getCssClassValue:function(a,b){var c=$("<p></p>").addClass(a).hide().appendTo(this.element),d=c.css(b);return c.remove(),d},_clearTextSelection:function(){window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()},_getTimeFromAbsolutePosition:function(a,b){var c=this._getAngleFromAbsolutePosition(a,b);return this._getTimeFromAngle(c)},_getAngleFromAbsolutePosition:function(a,b){var c=this.element.svgContainer.offset(),d=a-c.left-this.middle,e=b-c.top-this.middle,f=Math.atan2(e,d)+Math.PI/2;return 0>f&&(f+=2*Math.PI),f},_radianToDegrees:function(a){return a*(180/Math.PI)},_degreesToRadian:function(a){return a*(Math.PI/180)},_getTooltipText:function(a){var e="",f="";if(this.twelveHoursLayout&&(this.amEnabled&&this.pmEnabled?f=d:this.amEnabled?f=b:this.pmEnabled&&(f=c)),null!==this.actualStartTime){e+=this._timeObjectToString(this.actualStartTime),this.amEnabled&&this.pmEnabled||(e+=" "+f),e+=" - ";var g=this.actualStartTime.hours-a.hours;this.actualStartTime.hours<12&&(a.hours>=12||g>0||0===g&&this.actualStartTime.minutes>a.minutes)&&(f===b?f=c:f===c&&(f=b))}return e+=this._timeObjectToString(a)+" "+f},_getTimeFromAngle:function(a){var b;b=this.twelveHoursLayout?6-1/30*((this._radianToDegrees(a)+h/2)%h)*-1:12-1/15*(this._radianToDegrees(a)%h)*-1,0>b&&(b+=12),b>12&&(b-=12);var c=parseInt(b);12!==c||!this.twelveHoursLayout&&0!==a||(c=0);var d=parseInt(b*f)%f;return{hours:c,minutes:d}},_getAngleFromTime:function(a,b){var c;return c=this.twelveHoursLayout?a*j+b*l:a*i+b*k},_getIntervalsFromTimeObj:function(a,b,c,d){var e=[],f=$.extend({},a);12===a.hours&&(f.hours=0);var g=$.extend({},b);return null!==b&&12===b.hours&&(g.hours=0),c&&(null!==b?((g.hours<f.hours||g.hours===f.hours&&g.minutes<f.minutes)&&(g.hours+=12),e.push({startTime:f,endTime:g})):e.push({startTime:f})),d&&(f=$.extend({},a),12===a.hours&&(f.hours=0),g=$.extend({},b),null!==b&&12===b.hours&&(g.hours=0),null!==b?((g.hours<f.hours||g.hours===f.hours&&g.minutes<f.minutes)&&(g.hours-=12),g.hours+=12,f.hours+=12,e.push({startTime:f,endTime:g})):e.push({startTime:f})),e},_redrawSvgArcs:function(){this.interactionGroups=[];for(var a=0;a<this.intervalCount;a++)this.interactionGroups.push(this.svg.group(this.interactionGroupOptions));for(a=0;a<this.intervalCount;a++)if(0===this.startAngles[a]&&0===this.endAngles[a])this.interactionGroups.push(this.svg.group(this.interactionGroupOptions)),this.svg.circle(this.interactionGroups[this.intervalCount],0,0,this.circleRadius);else{var b=this._polarToCartesian(this.circleRadius,this.startAngles[a]),c=this._polarToCartesian(this.circleRadius,this.endAngles[a]);b.angle=this.startAngles[a],c.angle=this.endAngles[a],this._drawSvgArc(b,c,this.interactionGroups[a])}},_createSvgArc:function(a,b){if(this.ctrlHold){if(this.interactionGroups.length>this.intervalCount)for(var c=this.intervalCount;c<this.interactionGroups.length;c++)this.svg.remove(this.interactionGroups[c]),this.interactionGroups.pop()}else this._clearArcGroups();this.interactionGroups.length!==this.intervalCount&&(console.error("length: "+this.interactionGroups.length),console.error("Count:  "+this.intervalCount)),this.interactionGroups.push(this.svg.group(this.interactionGroupOptions)),this._drawSvgArc(a,b,this.interactionGroups[this.intervalCount])},_drawSvgArc:function(a,b,c){if(this.arcPath=this.svg.createPath(),"undefined"==typeof b||null===b)this.arcPath.move(0,0).line([[0,0],[a.x,a.y]]).close();else{var d=b.angle-a.angle,e=!1;d>Math.PI&&(e=!0),0>d&&d>-1*Math.PI&&(e=!e),this.arcPath.move(0,0).line([[0,0],[a.x,a.y]]).arc(this.circleRadius,this.circleRadius,1,e,1,b.x,b.y).line([[b.x,b.y],[0,0]]).close()}this.svg.path(c,this.arcPath)},_clearArcGroups:function(){if(this.interactionGroups.length>0)for(var a=0;a<this.interactionGroups.length;a++)this.svg.remove(this.interactionGroups[a]);this.interactionGroups=[]},_clearSelection:function(){this.actualStartTime=null,this.actualArcStartPoint={},this.intervalCount=0,this.selectedIntervals=[],this.startAngles=[],this.endAngles=[],this._clearArcGroups(),this.arcPath=null},_clearSVGElements:function(){this.element.svgContainer.empty(),this.element.svgContainer.removeClass("hasSVG"),this.interactionGroups=[]},_timeObjectToString:function(a){var b=a.hours;return 0===b&&this.twelveHoursLayout&&(b=12),(10>b?"0"+b:b)+":"+(a.minutes<10?"0"+a.minutes:a.minutes)},_createBasicUIElement:function(){var a=this;if(this.element.tooltipContainer=$("<div></div>").addClass("jh-tooltip-container").hide().appendTo(this.element),this.options.showToggleLayoutButton||this.options.enableAmPmButtons){var e,f=$("<div></div>").addClass("jh-button-container").appendTo(this.element);this.options.enableAmPmButtons&&(e=$("<div></div>").addClass("jh-am-pm-button-container").appendTo(f),$(' <input type="radio" id="jh-am-button" name="radio" value="'+b+'"><label for="jh-am-button">'+b+"</label>").appendTo(e),$(' <input type="radio" id="jh-pm-button" name="radio" value="'+c+'"><label for="jh-pm-button">'+c+"</label>").appendTo(e),$(' <input type="radio" id="jh-both-button" name="radio"  value="'+d+'" checked="checked"><label for="jh-both-button">'+d+"</label>").appendTo(e),e.buttonset(),$("input:radio[name=radio]").change(function(){a.amEnabled=!1,a.pmEnabled=!1,this.value===b?a.amEnabled=!0:this.value===c?a.pmEnabled=!0:this.value===d&&(a.amEnabled=!0,a.pmEnabled=!0)}));var g;if(this.options.showToggleLayoutButton){var h=$("<div></div>").addClass("jh-toggle-button-container").appendTo(f);$(' <input type="checkbox" id="clockLayout"><label for="clockLayout">24h</label> ').appendTo(h),g=$("#clockLayout").button().on("change",function(){var b=$(this).is(":checked");a.twelveHoursLayout=!b,"undefined"!=typeof e&&(b?e.hide():e.show()),a._clearSVGElements(),a._clearSelection(),a._createSVGElements()})}"undefined"!=typeof e&&(a.twelveHoursLayout?("undefined"!=typeof g&&g.prop("checked",!1),e.show()):("undefined"!=typeof g&&g.prop("checked",!0),e.hide()),"undefined"!=typeof g&&g.button("refresh")),this.buttonContainerHeight=f.outerHeight()}},_createSVGElements:function(){function a(a){b.svg=a,$(a.root()).attr("width","100%").attr("height","100%"),document.getElementsByTagName("svg")[0].setAttribute("viewBox","0 0 "+b.svgWidthHeight+" "+b.svgWidthHeight);var c=b.circleRadius;b.options.showFaceCircle&&a.circle(b.middle,b.middle,c,b.options.faceCircleOptions);var d=a.group({stroke:"black",transform:"translate("+b.middle+","+b.middle+")"}),e=b.circleRadius-b.options.faceTicksTinyLength,f=b.options.faceTicksTinyOptions,g=6;b.twelveHoursLayout||(g/=2);for(var k=0;h>k;k+=g)f.transform="rotate("+k+")",a.line(d,0,b.circleRadius,0,e,f);var l=b.circleRadius-b.options.faceTicksLargeLength;for(g=j,b.twelveHoursLayout||(g=i),k=0;h>k;k+=g)f=b.options.faceTicksLargeOptions,f.transform="rotate("+k+")",a.line(d,0,b.circleRadius,0,l,f);b.options.showHourLabels&&(b.twelveHoursLayout?(a.text(d,0,-b.circleRadius-12,"12"),a.text(d,0,b.circleRadius+b.hourLabelFontSize+6,"6"),a.text(d,-b.circleRadius-b.hourLabelFontSize,b.hourLabelFontSize/4,"9"),a.text(d,b.circleRadius+b.hourLabelFontSize,b.hourLabelFontSize/4,"3")):(a.text(d,0,-b.circleRadius-12,"0"),a.text(d,0,b.circleRadius+b.hourLabelFontSize+6,"12"),a.text(d,-b.circleRadius-b.hourLabelFontSize,b.hourLabelFontSize/4,"18"),a.text(d,b.circleRadius+b.hourLabelFontSize,b.hourLabelFontSize/4,"6")),$("text",a.root()).attr("text-anchor","middle").addClass("hour-label"))}var b=this;this.element.svgContainer.svg({onLoad:a})},_destroy:function(){},_setOption:function(){$.Widget.prototype._setOption.apply(this,arguments)},refresh:function(){this._clearSVGElements(),this._initSVGSizeVariables(),this.element.svgContainer.width(this.svgWidthHeight).height(this.svgWidthHeight),this._createSVGElements(),this._redrawSvgArcs()}})});