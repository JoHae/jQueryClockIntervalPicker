$(function(){var a=15,b="AM",c="PM",d="AM/PM",e=24,f=60,g=24*f,h=360,i=h/e,j=2*i,k=i/f,l=j/f,m="http://www.w3.org/2000/svg",n={class_:"class",in_:"in",alignmentBaseline:"alignment-baseline",baselineShift:"baseline-shift",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorRendering:"color-rendering",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",underlinePosition:"underline-position",underlineThickness:"underline-thickness",vertAdvY:"vert-adv-y",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode"};$.widget("jh.clockTimeIntervalPicker",{options:{multiSelection:!0,enableAmPmButtons:!0,showToggleLayoutButton:!0,useTwelveHoursLayout:!0,showHourLabels:!0,selectionTicksMinutes:30,showIndicatorLine:!0,indicatorLineOptions:{stroke:"black",strokeWidth:2},faceTicksLargeLength:8,faceTicksLargeOptions:{strokeWidth:4},faceTicksTinyLength:5,faceTicksTinyOptions:{strokeWidth:2},showFaceCircle:!1,faceCircleOptions:{fillOpacity:0,stroke:"black",strokeOpacity:1,strokeWidth:2},faceOverlayOptions:{fill:"blue",fillOpacity:.4,stroke:"blue",strokeOpacity:.4,strokeWidth:1}},_create:function(){this.actualStartTime=null,this.selectedIntervals=[],this.intervalCount=0,this.ctrlHold=!1,this.amEnabled=!0,this.pmEnabled=!0,this.startAngles=[],this.endAngles=[],this.twelveHoursLayout=this.options.useTwelveHoursLayout,this.buttonContainerHeight=0,this._createBasicUIElement(),this.interactionGroupOptions=this.options.faceOverlayOptions,this.actualArcStartPoint={},this.arcPath=null,this.interactionGroups=[],this.svg=null,this.indicatorLineGroup=null,this._initSVGSizeVariables(),this.ticksMinutes=[];for(var a=g/this.options.selectionTicksMinutes,b=0;a>=b;b++)this.ticksMinutes.push(b*this.options.selectionTicksMinutes);this.element.svgContainer=$("<div></div>").addClass("jh-svg-container").width(this.svgWidthHeight).height(this.svgWidthHeight).attr("oncontextmenu","return false;").appendTo(this.element),this._createSVGElements(),this._initMouseEventHandlers()},_initSVGSizeVariables:function(){this.availableWidth=this.element.width(),this.availableHeight=this.element.height(),this.availableSVGWidth=this.availableWidth,this.availableSVGHeight=this.availableHeight-this.buttonContainerHeight,this.svgWidthHeight=Math.min(this.availableSVGWidth,this.availableSVGHeight),this.circleRadius=this.svgWidthHeight/2,this.options.showFaceCircle&&(this.circleRadius-=2*this.options.faceCircleOptions.strokeWidth),this.options.showHourLabels&&(this.hourLabelFontSize=parseInt(this._getCssClassValue("hour-label","font-size")),this.circleRadius-=2*this.hourLabelFontSize),this.middle=this.svgWidthHeight/2,this.interactionGroupOptions.transform="translate("+this.middle+","+this.middle+")"},_initMouseEventHandlers:function(){var b=this,c=0,d=0,e=!1;this.element.svgContainer.mousedown(function(a){if(b._clearTextSelection(),3===a.which)return void(b.intervalCount>0?(b._clearSelection(),b.element.trigger("selectionChanged",{intervals:{}})):(b.amEnabled&&b.selectedIntervals.push({startTime:{hours:0,minutes:0},endTime:{hours:11,minutes:59}}),b.pmEnabled&&b.selectedIntervals.push({startTime:{hours:12,minutes:0},endTime:{hours:23,minutes:59}}),b.interactionGroups.push(b._createSvgGroup(b.svg,b.interactionGroupOptions)),b._createSvgCircle(b.interactionGroups[b.intervalCount],0,0,b.circleRadius),b.intervalCount++,b.startAngles.push(0),b.endAngles.push(0),b.element.trigger("selectionChanged",{intervals:b.selectedIntervals})));b.ctrlHold=a.ctrlKey&&b.options.multiSelection,b.ctrlHold||b._clearSelection();var c=b._getTimeFromAbsolutePosition(a.pageX,a.pageY);b.actualStartTime=b._getTickTime(c.hours,c.minutes);var d=b._degreesToRadian(b._getAngleFromTime(b.actualStartTime.hours,b.actualStartTime.minutes));b.actualArcStartPoint=b._polarToCartesian(b.circleRadius,d),b._createSvgArc(b.actualArcStartPoint),e=!0,b.element.trigger("selectionStarted",{intervals:b._getIntervalsFromTimeObj(b.actualStartTime,null,b.amEnabled,b.pmEnabled)})}),this.element.svgContainer.mouseup(function(a){if(3!==a.which){b._clearTextSelection();var c=b._getTimeFromAbsolutePosition(a.pageX,a.pageY),d=b._getTickTime(c.hours,c.minutes);b.intervalCount++,e=!1;var f=b._getIntervalsFromTimeObj(b.actualStartTime,d,b.amEnabled,b.pmEnabled);b.selectedIntervals=b.selectedIntervals.concat(f),b.startAngles.push(b._degreesToRadian(b._getAngleFromTime(b.actualStartTime.hours,b.actualStartTime.minutes))),b.endAngles.push(b._degreesToRadian(b._getAngleFromTime(d.hours,d.minutes))),b.actualStartTime=null,b.element.trigger("selectionEnded",{intervals:f}),b.element.trigger("selectionChanged",{intervals:b.selectedIntervals})}}),this.element.svgContainer.mouseleave(function(){b._clearIndicatorLine(),b.element.tooltipContainer.hide()}),this.element.svgContainer.mouseenter(function(){b.element.tooltipContainer.show()}),this.element.svgContainer.mousemove(function(f){if(f.pageX!==d||f.pageY!==c){d=f.pageX,c=f.pageY,b._clearTextSelection();var g=b._getTimeFromAngle(b._getAngleFromAbsolutePosition(d,c)),h=b._getTickTime(g.hours,g.minutes),i=b._degreesToRadian(b._getAngleFromTime(h.hours,h.minutes)),j=b.element.offset();if(b.element.tooltipContainer.css("left",d-j.left+a).css("top",c-j.top).text(b._getTooltipText(h)),e){var k=b._polarToCartesian(b.circleRadius,i);b._createSvgArc(b.actualArcStartPoint,k)}b._drawIndicatorLine(i)}})},_getTickTime:function(a,b){for(var c,d=a*f+b,e=0;e<this.ticksMinutes.length-1;e++){var g=this.ticksMinutes[e],h=this.ticksMinutes[e+1];if(d>=g&&h>=d){var i=d-g,j=h-d;c=j>i?g:h;break}}var k=parseInt(c/f);return 24===k&&(k=0),{hours:k,minutes:c%f}},_polarToCartesian:function(a,b){return{x:a*Math.sin(b),y:a*Math.cos(b)*-1,angle:b}},_drawIndicatorLine:function(a){this._clearIndicatorLine();var b={transform:"translate("+this.middle+","+this.middle+")"};this.indicatorLineGroup=this._createSvgGroup(this.svg,b),this.options.indicatorLineOptions.transform="rotate("+this._radianToDegrees(a)+")",this._createSvgLine(this.indicatorLineGroup,0,0,0,-this.circleRadius,this.options.indicatorLineOptions)},_clearIndicatorLine:function(){null!==this.indicatorLineGroup&&(this._removeElement(this.indicatorLineGroup),this.indicatorLineGroup=null)},_getCssClassValue:function(a,b){var c=$("<p></p>").addClass(a).hide().appendTo(this.element),d=c.css(b);return c.remove(),d},_clearTextSelection:function(){window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()},_getTimeFromAbsolutePosition:function(a,b){var c=this._getAngleFromAbsolutePosition(a,b);return this._getTimeFromAngle(c)},_getAngleFromAbsolutePosition:function(a,b){var c=this.element.svgContainer.offset(),d=a-c.left-this.middle,e=b-c.top-this.middle,f=Math.atan2(e,d)+Math.PI/2;return 0>f&&(f+=2*Math.PI),f},_radianToDegrees:function(a){return a*(180/Math.PI)},_degreesToRadian:function(a){return a*(Math.PI/180)},_getTooltipText:function(a){var e="",f="";if(this.twelveHoursLayout&&(this.amEnabled&&this.pmEnabled?f=d:this.amEnabled?f=b:this.pmEnabled&&(f=c)),null!==this.actualStartTime){e+=this._timeObjectToString(this.actualStartTime),this.amEnabled&&this.pmEnabled||(e+=" "+f),e+=" - ";var g=this.actualStartTime.hours-a.hours;this.actualStartTime.hours<12&&(a.hours>=12||g>0||0===g&&this.actualStartTime.minutes>a.minutes)&&(f===b?f=c:f===c&&(f=b))}return e+=this._timeObjectToString(a)+" "+f},_getTimeFromAngle:function(a){var b;b=this.twelveHoursLayout?6-1/30*((this._radianToDegrees(a)+h/2)%h)*-1:12-1/15*(this._radianToDegrees(a)%h)*-1,0>b&&(b+=12),b>12&&(b-=12);var c=parseInt(b);12!==c||!this.twelveHoursLayout&&0!==a||(c=0);var d=parseInt(b*f)%f;return{hours:c,minutes:d}},_getAngleFromTime:function(a,b){var c;return c=this.twelveHoursLayout?a*j+b*l:a*i+b*k},_getIntervalsFromTimeObj:function(a,b,c,d){var e=[],f=$.extend({},a);12===a.hours&&(f.hours=0);var g=$.extend({},b);return null!==b&&12===b.hours&&(g.hours=0),c&&(null!==b?((g.hours<f.hours||g.hours===f.hours&&g.minutes<f.minutes)&&(g.hours+=12),e.push({startTime:f,endTime:g})):e.push({startTime:f})),d&&(f=$.extend({},a),12===a.hours&&(f.hours=0),g=$.extend({},b),null!==b&&12===b.hours&&(g.hours=0),null!==b?((g.hours<f.hours||g.hours===f.hours&&g.minutes<f.minutes)&&(g.hours-=12),g.hours+=12,f.hours+=12,e.push({startTime:f,endTime:g})):e.push({startTime:f})),e},_redrawSvgArcs:function(){this.interactionGroups=[];for(var a=0;a<this.intervalCount;a++)this.interactionGroups.push(this._createSvgGroup(this.svg,this.interactionGroupOptions));for(a=0;a<this.intervalCount;a++)if(0===this.startAngles[a]&&0===this.endAngles[a])this.interactionGroups.push(this._createSvgGroup(this.svg,this.interactionGroupOptions)),this._createSvgCircle(this.interactionGroups[this.intervalCount],0,0,this.circleRadius);else{var b=this._polarToCartesian(this.circleRadius,this.startAngles[a]),c=this._polarToCartesian(this.circleRadius,this.endAngles[a]);b.angle=this.startAngles[a],c.angle=this.endAngles[a],this._drawSvgArc(b,c,this.interactionGroups[a])}},_createSvgArc:function(a,b){if(this.ctrlHold){if(this.interactionGroups.length>this.intervalCount)for(var c=this.intervalCount;c<this.interactionGroups.length;c++)this._removeElement(this.interactionGroups[c]),this.interactionGroups.pop()}else this._clearArcGroups();this.interactionGroups.length!==this.intervalCount&&(console.error("length: "+this.interactionGroups.length),console.error("Count:  "+this.intervalCount)),this.interactionGroups.push(this._createSvgGroup(this.svg,this.interactionGroupOptions)),this._drawSvgArc(a,b,this.interactionGroups[this.intervalCount])},_drawSvgArc:function(a,b,c){if(this.arcPath=this._svgPathMove(0,0)+this._svgPathLine(0,0,a.x,a.y),"undefined"!=typeof b&&null!==b){var d=b.angle-a.angle,e=!1;d>Math.PI&&(e=!0),0>d&&d>-1*Math.PI&&(e=!e),this.arcPath+=this._svgPathArc(this.circleRadius,this.circleRadius,1,e,1,b.x,b.y)+this._svgPathLine(b.x,b.y,0,0)}this._svgPathCloseAndAppend(c,this.arcPath)},_clearArcGroups:function(){if(this.interactionGroups.length>0)for(var a=0;a<this.interactionGroups.length;a++)this._removeElement(this.interactionGroups[a]);this.interactionGroups=[]},_clearSelection:function(){this.actualStartTime=null,this.actualArcStartPoint={},this.intervalCount=0,this.selectedIntervals=[],this.startAngles=[],this.endAngles=[],this._clearArcGroups(),this.arcPath=null},_clearSVGElements:function(){this.element.svgContainer.empty(),this.element.svgContainer.removeClass("hasSVG"),this.interactionGroups=[]},_timeObjectToString:function(a){var b=a.hours;return 0===b&&this.twelveHoursLayout&&(b=12),(10>b?"0"+b:b)+":"+(a.minutes<10?"0"+a.minutes:a.minutes)},_createBasicUIElement:function(){var a=this;if(this.element.tooltipContainer=$("<div></div>").addClass("jh-tooltip-container").hide().appendTo(this.element),this.options.showToggleLayoutButton||this.options.enableAmPmButtons){var e,f=$("<div></div>").addClass("jh-button-container").appendTo(this.element);this.options.enableAmPmButtons&&(e=$("<div></div>").addClass("jh-am-pm-button-container").appendTo(f),$(' <input type="radio" id="jh-am-button" name="radio" value="'+b+'"><label for="jh-am-button">'+b+"</label>").appendTo(e),$(' <input type="radio" id="jh-pm-button" name="radio" value="'+c+'"><label for="jh-pm-button">'+c+"</label>").appendTo(e),$(' <input type="radio" id="jh-both-button" name="radio"  value="'+d+'" checked="checked"><label for="jh-both-button">'+d+"</label>").appendTo(e),e.buttonset(),$("input:radio[name=radio]").change(function(){a.amEnabled=!1,a.pmEnabled=!1,this.value===b?a.amEnabled=!0:this.value===c?a.pmEnabled=!0:this.value===d&&(a.amEnabled=!0,a.pmEnabled=!0)}));var g;if(this.options.showToggleLayoutButton){var h=$("<div></div>").addClass("jh-toggle-button-container").appendTo(f);$(' <input type="checkbox" id="clockLayout"><label for="clockLayout">24h</label> ').appendTo(h),g=$("#clockLayout").button().on("change",function(){var b=$(this).is(":checked");a.twelveHoursLayout=!b,"undefined"!=typeof e&&(b?e.hide():e.show()),a._clearSVGElements(),a._clearSelection(),a._createSVGElements()})}"undefined"!=typeof e&&(a.twelveHoursLayout?("undefined"!=typeof g&&g.prop("checked",!1),e.show()):("undefined"!=typeof g&&g.prop("checked",!0),e.hide()),"undefined"!=typeof g&&g.button("refresh")),this.buttonContainerHeight=f.outerHeight()}},_createSVGElements:function(){var a=this;this.svg=document.createElementNS(m,"svg"),this.svg.setAttribute("version","1.1"),this.svg.setAttribute("width","100%"),this.svg.setAttribute("height","100%"),this.svg.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),this.svg.setAttribute("viewBox","0 0 "+a.svgWidthHeight+" "+a.svgWidthHeight),this.element.svgContainer.append(this.svg);var b=a.circleRadius;a.options.showFaceCircle&&a._createSvgCircle(this.svg,a.middle,a.middle,b,a.options.faceCircleOptions);var c=a._createSvgGroup(this.svg,{stroke:"black",transform:"translate("+a.middle+","+a.middle+")"}),d=a.circleRadius-a.options.faceTicksTinyLength,e=a.options.faceTicksTinyOptions,f=6;a.twelveHoursLayout||(f/=2);for(var g=0;h>g;g+=f)e.transform="rotate("+g+")",a._createSvgLine(c,0,a.circleRadius,0,d,e);var k=a.circleRadius-a.options.faceTicksLargeLength;for(f=j,a.twelveHoursLayout||(f=i),g=0;h>g;g+=f)e=a.options.faceTicksLargeOptions,e.transform="rotate("+g+")",a._createSvgLine(c,0,a.circleRadius,0,k,e);if(a.options.showHourLabels){var l="hour-label",n={textAnchor:"middle"};a.twelveHoursLayout?(a._createSvgText(c,0,-a.circleRadius-12,"12",l,n),a._createSvgText(c,0,a.circleRadius+a.hourLabelFontSize+6,"6",l,n),a._createSvgText(c,-a.circleRadius-a.hourLabelFontSize,a.hourLabelFontSize/4,"9",l,n),a._createSvgText(c,a.circleRadius+a.hourLabelFontSize,a.hourLabelFontSize/4,"3",l,n)):(a._createSvgText(c,0,-a.circleRadius-12,"0",l,n),a._createSvgText(c,0,a.circleRadius+a.hourLabelFontSize+6,"12",l,n),a._createSvgText(c,-a.circleRadius-a.hourLabelFontSize,a.hourLabelFontSize/4,"18",l,n),a._createSvgText(c,a.circleRadius+a.hourLabelFontSize,a.hourLabelFontSize/4,"6",l,n))}},_setSvgElementAttributes:function(a,b){for(var c in b){var d=b[c];null!==d&&a.setAttribute(n[c]||c,d)}},_createSvgCircle:function(a,b,c,d,e){var f=this._createSvgElement(a,"circle");return f.setAttribute("cx",b),f.setAttribute("cy",c),f.setAttribute("r",d),this._setSvgElementAttributes(f,e),a.appendChild(f),f},_createSvgLine:function(a,b,c,d,e,f){var g=this._createSvgElement(a,"line");return g.setAttribute("x1",b),g.setAttribute("y1",c),g.setAttribute("x2",d),g.setAttribute("y2",e),this._setSvgElementAttributes(g,f),g},_createSvgGroup:function(a,b){var c=this._createSvgElement(a,"g");return this._setSvgElementAttributes(c,b),c},_createSvgText:function(a,b,c,d,e,f){var g=this._createSvgElement(a,"text");return g.innerHTML=d,g.setAttribute("x",b),g.setAttribute("y",c),g.setAttribute("class",e),this._setSvgElementAttributes(g,f),g},_svgPathLine:function(a,b,c,d){return this._svgPathCoordinatesArr("L",[[a,b],[c,d]])},_svgPathMove:function(a,b){return this._svgPathCoordinates("M",a,b)},_svgPathArc:function(a,b,c,d,e,f,g){var h="A";return h+=a+","+b+" "+c+" "+(d?"1":"0")+","+(e?"1":"0")+" "+f+","+g},_svgPathCloseAndAppend:function(a,b){var c=this._createSvgElement(a,"path");return b+="z",c.setAttribute("d",b),c},_svgPathCoordinates:function(a,b,c){var d="";return d+=a+b+","+c},_svgPathCoordinatesArr:function(a,b){for(var c="",d=0;d<b.length;d++){var e=b[d];c+=(0===d?a:" ")+e[0]+","+e[1]+(e.length<4?"":" "+e[2]+","+e[3]+(e.length<6?"":" "+e[4]+","+e[5]))}return c},_createSvgElement:function(a,b){var c=document.createElementNS(m,b);return a.appendChild(c),c},_removeElement:function(a){a.parentElement.removeChild(a)},_destroy:function(){},_setOption:function(){$.Widget.prototype._setOption.apply(this,arguments)},refresh:function(){this._clearSVGElements(),this._initSVGSizeVariables(),this.element.svgContainer.width(this.svgWidthHeight).height(this.svgWidthHeight),this._createSVGElements(),this._redrawSvgArcs()}})});